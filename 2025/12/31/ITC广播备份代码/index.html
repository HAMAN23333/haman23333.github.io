
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <title>ITCå¹¿æ’­å¤‡ä»½ä»£ç  | HAMAN&#39;s Blog</title>
    <meta name="author" content="HAMAN" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.png" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<script src="/js/lib/toc.js"></script>


<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 8.1.1"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜ æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>HAMAN&#39;S BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;HAMAN&#39;S BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            

<div class="post-main-wrapper has-toc">
    <div class="article">
        <div>
            <h1>ITCå¹¿æ’­å¤‡ä»½ä»£ç </h1>
        </div>
        <div class="info">
            <span class="date">
                <span class="icon">
                    <i class="fa-solid fa-calendar fa-fw"></i>
                </span>
                2025/12/31
            </span>
            
            <span class="category">
                <a href="/categories/Code/">
                    <span class="icon">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </span>
                    Code
                </a>
            </span>
            
            
            <span class="tags">
                <span class="icon">
                    <i class="fa-solid fa-tags fa-fw"></i>
                </span>
                
                
                <span class="tag">
                    
                    <a href="/tags/%E5%B7%A5%E4%BD%9C/" style="color: #ff7d73">
                        å·¥ä½œ
                    </a>
                </span>
                
                <span class="tag">
                    
                    <a href="/tags/Python/" style="color: #00a596">
                        Python
                    </a>
                </span>
                
            </span>
            
        </div>

        
            <div class="content" v-pre>
                <p>ä»–å®¶çš„è®¾å¤‡è¯´æ˜ä¹¦ä¹Ÿåƒæ˜¯3å²å°å­©å†™çš„ï¼Œæœºå™¨è‡ªå¸¦çš„å¤‡ä»½å‡ ä¹æ— æ³•ä½¿ç”¨ï¼Œåªèƒ½é€šè¿‡ç½‘é¡µçˆ¬è™«å…¨å±€ä¸‹è½½å¤‡ä»½ï¼Œè‡ªå·±æ‰‹æ’¸äº†ä¸ªè„šæœ¬ã€‚</p>
<span id="more"></span>

<h1 id="è·å–-token-å‚æ•°"><a href="#è·å–-token-å‚æ•°" class="headerlink" title="è·å– token å‚æ•°"></a>è·å– token å‚æ•°</h1><pre><code class="language-python">import requests

def get_token():
    # ç™»å½•è¯·æ±‚å‚æ•°
    url = &quot;http://192.168.XXX.XXX:81/api/v2/auth&quot; 
    params = {
        &quot;userinfo&quot;: &quot;true&quot;,
        &quot;withRoles&quot;: &quot;true&quot;,
        &quot;withUsersConfig&quot;: &quot;true&quot;,
        &quot;name&quot;: &quot;XXXXXXXXXXXXXXXXXXXX&quot;,
        &quot;password&quot;: &quot;XXXXXXXXXXXXXXXXXXXXXXX&quot;
    }
    
    # æ„é€ è¯·æ±‚å¤´ï¼ˆæ ¹æ®æä¾›çš„è¯·æ±‚æ ‡å¤´ï¼‰
    headers = {
        &quot;Accept&quot;: &quot;application/json, text/plain, */*&quot;,
        &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,
        &quot;Accept-Language&quot;: &quot;zh-CN,zh-TW;q=0.9,zh;q=0.8,en-US;q=0.7,en;q=0.6&quot;,
        &quot;Connection&quot;: &quot;keep-alive&quot;,
        &quot;Host&quot;: &quot;192.168.XXX.XXX:81&quot;,
        &quot;Referer&quot;: &quot;http://192.168.XXX.XXX:81/login&quot;,
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0&quot;,
        &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;
    }
    
    try:
        response = requests.get(url, params=params, headers=headers, timeout=10)
        
        if response.status_code == 200:
            data = response.json()
            
            # ä¿®æ”¹ç‚¹ï¼šä»åµŒå¥—ç»“æ„ä¸­æå– token
            token = data.get(&#39;result&#39;, {}).get(&#39;token&#39;)
            return token
        else:
            print(f&quot;è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š{response.status_code}ï¼Œå“åº”å†…å®¹ï¼š{response.text}&quot;)
            return None
            
    
    except requests.exceptions.RequestException as e:
        print(&quot;è¯·æ±‚å‘ç”Ÿå¼‚å¸¸ï¼š&quot;, str(e))
        return None
    except ValueError as e:
        print(&quot;JSON è§£æå¤±è´¥ï¼š&quot;, str(e))
        return None
</code></pre>
<h1 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h1><pre><code class="language-python">import requests
import time

def get_download_url(token):
    # è·å–æ–‡ä»¶ä¸‹è½½åœ°å€
    url = &quot;http://192.168.XXX.XXX:81/api/v2/backup&quot;
    params = {&quot;database&quot;: &quot;true&quot;, &quot;medias&quot;: &quot;true&quot;}
    
    headers = {
        &quot;Authorization&quot;: token,
        &quot;Accept&quot;: &quot;application/json, text/plain, */*&quot;,
        &quot;Host&quot;: &quot;192.168.XXX.XXX:81&quot;,
        &quot;Referer&quot;: &quot;http://192.168.XXX.XXX:81/system/servers&quot;,
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0&quot;,
        &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;
    }

    try:
        response = requests.get(url, params=params, headers=headers, timeout=60)
        if response.status_code == 200:
            return response.json()[&#39;result&#39;][&#39;url&#39;].replace(&#39;\\/&#39;, &#39;/&#39;)
        print(f&quot;è·å–ä¸‹è½½åœ°å€å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š{response.status_code}&quot;)
        return None
    except Exception as e:
        print(f&quot;è·å–ä¸‹è½½åœ°å€å¼‚å¸¸ï¼š{str(e)}&quot;)
        return None

def download_file(download_url, token):
    # æ‰§è¡Œæ–‡ä»¶ä¸‹è½½
    try:
        headers = {&quot;Authorization&quot;: token}
        
        with requests.get(download_url, headers=headers, stream=True, timeout=30) as r:
            r.raise_for_status()
            
            # ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶å
            filename = f&quot;{download_url.split(&#39;/&#39;)[-1].split(&#39;.&#39;)[0]}_{int(time.time())}.zip&quot;
            
            with open(filename, &#39;wb&#39;) as f:
                for chunk in r.iter_content(chunk_size=8192):
                    if chunk:
                        f.write(chunk)
            return filename
        return None
    except Exception as e:
        print(f&quot;ä¸‹è½½æ–‡ä»¶å¼‚å¸¸ï¼š{str(e)}&quot;)
        return None
</code></pre>
<h1 id="MAIN"><a href="#MAIN" class="headerlink" title="MAIN"></a>MAIN</h1><pre><code class="language-python">from auth import get_token
from downloader import get_download_url, download_file

def main():
    # ç¬¬ä¸€æ­¥ï¼šè·å–token
    print(&quot;æ­£åœ¨è·å–è®¿é—®ä»¤ç‰Œ...&quot;)
    token = get_token()
    
    if not token:
        print(&quot;âŒ è®¤è¯å¤±è´¥ï¼Œç¨‹åºç»ˆæ­¢&quot;)
        return

    # ç¬¬äºŒæ­¥ï¼šè·å–ä¸‹è½½åœ°å€
    print(&quot;ğŸ”„ æ­£åœ¨è·å–ä¸‹è½½åœ°å€...&quot;)
    download_url = get_download_url(token)
    
    if not download_url:
        print(&quot;âŒ è·å–ä¸‹è½½åœ°å€å¤±è´¥&quot;)
        return

    # ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œä¸‹è½½
    print(f&quot;â¬ å¼€å§‹ä¸‹è½½æ–‡ä»¶ï¼š{download_url}&quot;)
    saved_file = download_file(download_url, token)
    
    if saved_file:
        print(f&quot;âœ… æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼š{saved_file}&quot;)
    else:
        print(&quot;âŒ æ–‡ä»¶ä¸‹è½½å¤±è´¥&quot;)

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>

            </div>
        

        
            <div class="comments-section">
                
                
                
                
            </div>
        
    </div>

     <aside class="toc-sidebar">
        
            <div class="toc-wrapper">
                <div class="toc-header">
                    <i class="fa-solid fa-list"></i> ç›®å½•
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-token-%E5%8F%82%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">è·å– token å‚æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD"><span class="toc-number">2.</span> <span class="toc-text">ä¸‹è½½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MAIN"><span class="toc-number">3.</span> <span class="toc-text">MAIN</span></a></li></ol>
            </div>
    
    <div class="toc-nav-buttons">
                <a href="javascript:;" onclick="window.scrollTo({top: 0, behavior: 'smooth'});" class="toc-btn" title="å›åˆ°é¡¶éƒ¨">
                    <i class="fa-solid fa-arrow-up"></i> é¡¶éƒ¨
                </a>
            </div>
        
</aside> 
    
</div>
            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2025 - 2025 HAMAN&#39;s Blog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;HAMAN
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
